import { Link, useRouter } from 'expo-router';
import React from 'react';
import { KeyboardAvoidingView, Platform, Pressable, SafeAreaView, StyleSheet, View, useWindowDimensions } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { ThemedText } from '@/components/ThemedText';
import { ThemedView } from '@/components/ThemedView';
import { StatusBar } from 'expo-status-bar';

// Mobile-only onboarding inspired layout
export default function MobileOnboarding() {
  const router = useRouter();
  const insets = useSafeAreaInsets();
  const { width } = useWindowDimensions();
  const dynamicRadius = Math.round(width * 0.2); // ~20% of screen width

  return (
    <KeyboardAvoidingView behavior={Platform.select({ ios: 'padding', android: undefined })} style={{ flex: 1 }}>
      <ThemedView style={{ flex: 1 }}>
        <SafeAreaView style={styles.root}>
          <StatusBar style="light" backgroundColor="#2563EB" />
          {/* Paint the top safe-area to blue */}
          <View style={{ height: insets.top, backgroundColor: BLUE, position: 'absolute', top: 0, left: 0, right: 0 }} />
          {/* Hero area (blue background) */}
          <View style={[
            styles.hero,
            { borderBottomLeftRadius: dynamicRadius, borderBottomRightRadius: dynamicRadius },
          ]}>
            {/* Empty: add image or carousel later */}
          </View>

          {/* Headline (moved further lower) */}
          <View style={{ paddingHorizontal: 24, marginTop: 48 }}>
            <ThemedText style={styles.h1}>Todas tus facturas en un solo lugar</ThemedText>
            <ThemedText style={styles.muted}>
              Controla tus ventas y simplifica tu facturación sin complicaciones.
            </ThemedText>
          </View>

          {/* Bottom fixed CTAs */}
          <View style={[styles.bottomCtas, { paddingBottom: Math.max(28, insets.bottom + 20) }]}>
            <Pressable onPress={() => router.push('/(auth)/signup')} style={({ pressed }) => [styles.primaryBtn, pressed && styles.pressed] }>
              <ThemedText style={styles.primaryText}>Crear cuenta</ThemedText>
            </Pressable>
            <View style={styles.loginInline}>
              <ThemedText style={styles.loginMuted}>¿Ya tienes cuenta? </ThemedText>
              <Link href="/(auth)/login"><ThemedText style={styles.loginLink}>Iniciar sesión</ThemedText></Link>
            </View>
          </View>
        </SafeAreaView>
      </ThemedView>
    </KeyboardAvoidingView>
  );
}

const BLUE = '#2563EB';

const styles = StyleSheet.create({
  root: { flex: 1, position: 'relative' },
  hero: {
    backgroundColor: BLUE,
    alignItems: 'center',
    justifyContent: 'center',
    height: '50%',
    paddingTop: 24,
    paddingBottom: 24,
    borderBottomLeftRadius: 32,
    borderBottomRightRadius: 32,
    position: 'relative',
  },
  illustrationPlaceholder: {
    width: 280,
    height: 200,
    borderRadius: 16,
    backgroundColor: 'rgba(255,255,255,0.6)',
  },
  h1: { textAlign: 'center', fontSize: 26, lineHeight: 30, fontWeight: '700' },
  muted: { textAlign: 'center', opacity: 0.7, marginTop: 8 },
  dotsFloating: { position: 'absolute', bottom: 12, right: 16, flexDirection: 'row', gap: 8, alignItems: 'center' },
  dot: { width: 8, height: 8, borderRadius: 4, backgroundColor: 'rgba(0,0,0,0.15)' },
  dotActive: { width: 28, borderRadius: 8, backgroundColor: BLUE },
  bottomCtas: { position: 'absolute', left: 24, right: 24, bottom: 0, gap: 12 },
  primaryBtn: { backgroundColor: BLUE, borderRadius: 14, paddingVertical: 14, alignItems: 'center' },
  primaryText: { color: '#fff', fontWeight: '700' },
  loginInline: { flexDirection: 'row', justifyContent: 'center', alignItems: 'center' },
  loginMuted: { opacity: 0.7 },
  loginLink: { color: BLUE, fontWeight: '700' },
  pressed: { opacity: 0.92 },
});
